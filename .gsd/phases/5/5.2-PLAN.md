---
phase: 5
plan: 2
wave: 1
---

# Plan 5.2: Unified `main.py` Entrypoint

## Objective
Harmonize the separate PC Hub components (Phase 1's Whisper, Phase 3's Vectors/Ollama, Phase 4's TTS) into a single optimized event loop.

## Context
- .gsd/ROADMAP.md
- hub/main_server.py (from Phase 4)
- (Assuming Phase 1 whisper service exists or mapping mock variables permanently)

## Tasks

<task type="auto">
  <name>Refactor `main_server.py` to Unified Standard</name>
  <files>
    hub/main_server.py
    hub/tests/integration_test.py
  </files>
  <action>
    - The existing `get_recent_transcript()` logic relies on mocked Whisper audio. If Phase 1 Whisper is available locally, import its real transcript fetching logic.
    - If Phase 1 Whisper is NOT in this repository structurally, retain the mocked string but rename the mock context file to explicitly state `mock_whisper.py`.
    - Ensure `main_server.py` contains a robust `try/except` block enclosing the entire `websockets`, `requests` (Ollama), and `pyttsx3` dependencies so that if one fails, the loop doesn't crash the server.
    - Add clear, stylized `print()` console banners to indicate to users that "THE SYNAPSE HUB IS ONLINE" at startup.
  </action>
  <verify>python -m py_compile hub/main_server.py</verify>
  <done>Main hub coordinates the full split-brain pipeline cleanly without syntax errors.</done>
</task>

## Success Criteria
- [ ] PC Hub can be started with a single `python hub/main_server.py` command.
