---
phase: 2
plan: 2
wave: 2
---

# Plan 2.2: Firmware Implementation (Arduino & ESP8266)

## Objective
Develop the embedded software for the split-brain architecture. The Arduino reads the sensors and sends a formatted CSV string over Serial. The ESP8266 reads the Serial data, connects to WiFi, and hosts a WebSocket server for the PC Hub to connect to.

## Context
- .gsd/SPEC.md
- hardware/wiring_guide.md

## Tasks

<task type="auto">
  <name>Write Arduino Sensor Firmware</name>
  <files>synapse_sensor/synapse_sensor.ino</files>
  <action>
    Create the Arduino sketch to read 5 flex sensors, the Pulse Sensor, and the MPU6050.
    - Initialize I2C for MPU6050
    - Read analog values for flex and pulse
    - Format output as CSV: `<Flex1,Flex2,Flex3,Flex4,Flex5,GyroX,GyroY,HR>`
    - Send over `Serial.println()` at 115200 baud
    - Avoid delays; use `millis()` for a 50Hz update rate
  </action>
  <verify>arduino-cli compile --fqbn arduino:avr:nano synapse_sensor/synapse_sensor.ino (if arduino-cli is installed)</verify>
  <done>Sketch successfully reads all specified sensors and outputs correct CSV format.</done>
</task>

<task type="auto">
  <name>Write ESP8266 WebSocket Firmware</name>
  <files>synapse_wifi/synapse_wifi.ino</files>
  <action>
    Create the ESP8266 sketch to bridge Serial to WebSockets.
    - Connect to predefined WiFi credentials
    - Start a WebSocket server on port 81 (using `WebSocketsServer.h`)
    - In `loop()`, read incoming Serial lines from Arduino
    - Broadcast received CSV strings to all connected WebSocket clients
  </action>
  <verify>arduino-cli compile --fqbn esp8266:esp8266:nodemcuv2 synapse_wifi/synapse_wifi.ino (if installed)</verify>
  <done>Sketch bridges Serial input to WebSocket broadcasts.</done>
</task>

## Success Criteria
- [ ] Both firmware files are created with correct syntax and pin mappings.
- [ ] CSV format exactly matches `<F1,F2,F3,F4,F5,GX,GY,HR>`.
